\chapter{Number of paths+maxima}
\begin{rem}
  Once having stated basic definitions we may ask questions about occupation times of a set. Let $a>0$. How many steps up to time $n$ does our walk spend above $a$ (in interval $[a,\pinf)$)? Similarly how many steps does the walk spend in interval $[-a,\pinf)?$ We are going to answer these questions in following XXX\todo.
\end{rem}

\begin{rem}
  The assumption $p=\h$ simlifies the calculation of probabilities because we have $2^{-n}$ instead of $p^{\frac{n+x}{2}}q^{\frac{n-x}{2}}.$ Therefore each path of length $n$ hes equal probability of $2^{-n}.$
  Therefore the probabilities only depend on $\binom{n}{\frac{x+n}{2}}$ which can be more generalized like in the following definition.
\end{rem}

\begin{defn}[Number of possible paths]\label{defn-number_possible_paths}
 Let $n \in \N, a,b \in \Z.$ Let $N_n \left( a,b \right)$ be \emph{number of posssible paths} of random walk \rw\ from point $ \left( 0,a \right) $ to point $ \left( n,b \right)$
 and $N_n^x \left( a,b \right) $ be number of possible paths from point $ \left( 0,a \right) $ to point $\left( n,b \right)$
 that visit point $\left(z,x\right)$ for some $z \in \jn.$
\end{defn}
\begin{thm}[Number of possible paths]\label{thm-number_of_possible_paths}
 Let $a,b \in \Z, n \in \N$ then
 \[
    N_n \left( a,b \right) =\binom{n}{\h \left(n+b-a \right)}.
  \]
\end{thm}
\begin{proof}
 Let us choose a path from the point $ \left( 0,a \right) $ to point $ \left( n,b \right) $ and let $\alpha$ be number of the rightwards steps and $\beta$ be number of the leftwards steps.
 Then $\alpha+\beta=n$ and $\alpha-\beta=b-a$. By adding these two equations we get that $\alpha=\h \left( n+b-a \right) $.
 The number of possible paths is the number of ways of picking $\alpha$ rightwards steps from $n$ steps.
 Therefore we get $N_n \left( a,b \right) =\binom{n}{\alpha}=\binom{n}{\h \left( n+b-a \right) }.$
\end{proof}

\begin{thm}[Reflection principle]\label{thm-reflection_principle}
 Let $a,b \in \N$, then
 \[
    N_n^0 \left( a,b \right) =N_n \left( -a,b \right).
  \]
\end{thm}
\begin{proof}
 Each path from $ \left( 0,-a \right) $ to $ \left( n,b \right) $ has to intersect $y=0$-axis at least once at some point.
 Let $k$ be the \Time of the first intersection with $x$-axis. By reflecting the segment from $\left( 0,-a \right)$ to $\left( k,0 \right)$ in the $x$-axis and letting the segment from $\left(k,0\right)$ to $\left(n,b\right)$ stay the same as it was,
 we get a path from point $\left( 0,a \right)$ to $ \left(n,b\right)$ which visits $0$ \intime $k$.
 Because reflection is a bijective operation on sets of paths, we get the correspondence between the collections of such paths.
\end{proof}

\begin{rem}
  Following is the definition of return to origin which is a crucial term for this thesis.
  Let us come back to our question.
  While calculating the number of steps the walk spends in interval $[a,\pinf)$ we find the first passage through $a$ and then set $a$ as a new origin. However, our achievements concerning return to origin are in the latter subchapter.
\end{rem}

\begin{defn}[Return to origin]\label{defn-return_origin}
 \Lrw$, k \in \N$. We say a \emph{return to origin} occurred \intime $2k$ if $S_{2k}=0$. The probability that \intime $2k$ occurred a return to origin is denoted by $u_{2k}$.
 We say that \emph{the first return to origin} occurred \intime $2k$ if $S_1, S_2, \ldots S_{2k-1}\neq 0$ and $S_{2k}=0$.
 The probability that \intime $2k$ occurred the first return to origin is denoted by $f_{2k}$. We define $f_0 \dosad 0$.
 Let $\alpha_{2n} \left( 2k \right) $ denote $u_{2k}u_{2n-2k}.$
\end{defn}

\begin{thm}[Ballot theorem]\label{thm-ballot_theorem}
 Let $n,b \in \N$
 Number of paths from point $ \left( 0,0 \right) $ to point $ \left( n,b \right) $ which do not return to origin is equal to $\frac{b}{n}N_n \left( 0,b \right) $
\end{thm}
\begin{proof}
 Let us call $N$ the number of paths we are referring to.
 Because the path ends at point $ \left( n,b \right) $ and it does not return to origin, the first step has to be rightwards. Therefore we now have
 \[
    N=N_{n-1} \left( 1,b \right) -N_{n-1}^0 \left( 1,b \right) \overset{\text{T}\ref{thm-reflection_principle}}{=}N_{n-1} \left( 1,b \right) -N_{n-1} \left( -1,b \right).
\]


 Hence we get that:
 \[
 \begin{split}
 N & = N_{n-1} \left( 1,b \right) -N_{n-1} \left( -1,b \right)
 \overset{\text{T}\ref{thm-number_of_possible_paths}}{=} \binom{n-1}{\frac{n}{2}+\frac{b}{2}-1}-\binom{n-1}{\frac{n}{2}+\frac{b}{2}}\\
 & =\frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2}-1 \right) ! \left( \frac{n}{2}-\frac{b}{2} \right) !}-\frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2} \right) ! \left( \frac{n}{2}-\frac{b}{2}-1 \right) !}\\
 & =\frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2}-1 \right) ! \left( \frac{n}{2}-\frac{b}{2} \right) \left( \frac{n}{2}-\frac{b}{2}-1 \right) !}-\frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2} \right) \left( \frac{n}{2}+\frac{b}{2}-1 \right) ! \left( \frac{n}{2}-\frac{b}{2}-1 \right) !}\\
 & =\frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2}-1 \right) ! \left( \frac{n}{2}-\frac{b}{2}-1 \right) !} \left( \frac{1}{\frac{n}{2}-\frac{b}{2}}-\frac{1}{\frac{n}{2}+\frac{b}{2}} \right) \\
 & =\frac{1}{n}\frac{n!}{ \left( \frac{n}{2}+\frac{b}{2}-1 \right) ! \left( \frac{n}{2}-\frac{b}{2}-1 \right) !} \left( \frac{ \left( \frac{n}{2}+\frac{b}{2}-\frac{n}{2}+\frac{b}{2} \right) }{ \left( \frac{n}{2}-\frac{b}{2} \right) \left( \frac{n}{2}+\frac{b}{2} \right)} \right)\\
 & =\frac{b}{n}\frac{n!}{ \left( \frac{n}{2}+\frac{b}{2} \right) ! \left( \frac{n}{2}-\frac{b}{2} \right) !}=\frac{b}{n}\binom{n}{ \left( \frac{n}{2}+\frac{b}{2} \right)}
 \overset{\text{T}\ref{thm-number_of_possible_paths}}{=} \frac{b}{n}N_n \left( 0,b \right)
\end{split}
 \]
\end{proof}
 \begin{rem}
   The name \textit{Ballot theorem} comes from the question: In a ballot where candidate $A$ receives $p$ votes and candidate $B$ receives $q$ votes with $p > q$, what is the probability that $A$ had been strictly ahead of B throughout the whole count?

   Answer to this question can be derived from the previous theorem. In our case $b=p-q$ and $n=p+q.$
 \end{rem}
\begin{defn}[Maximum and minimum]\label{defn-max}
  \Lrw. $M_n^+\dosad \max \{S_i, i\in \jn\}$ is called \emph{maximum of random walk \rw} \emph{up to time $n$} and $M_n^-\dosad \min \{S_i, i\in \jn\}$ is called \emph{minimum of random walk \rw\ up to time $n.$} $M_n=\max\{M_n^+, -M_n^-\}$ is called \emph{absolute maximum of random walk \rw\ up to time $n.$}
\end{defn}
\begin{thm}[Probability of maximum up to \Time $n$]\label{thm-probability_maximum_upto_time}
 \Lrw.
 \[
 \pr \left(  M_n^+\geq r, S_n=b \right) =
 \begin{cases}
 \pr \left( S_n=b \right) & \text{for $b \geq r$ },\\
 \pr \left( S_n=2r-b \right) \left( \frac{q}{p} \right) ^{r-b}, & \text{for $otherwise$}.
 \end{cases}
 \]
\end{thm}
\begin{proof}
 Let us firstly consider the easier case in which $b \geq r$. Because we defined $ M_n^+$ as $\max \{S_i, i\in \jn \}$ we get that $ M_n^+ \geq b \geq r$
 therefore $[ M_n^+ \geq r] \subset [S_n=b]$ hence we get $\pr \left(  M_n^+\geq r, S_n=b \right) =
 \pr \left( S_n=b \right)$.

 Now let $r\geq 1, b<r$. $N_n^r \left( 0,b \right) $ stands for number of paths from point $ \left( 0,0 \right) $ to point $ \left( n,b \right) $ which reach up to $r$.
 Let $k \in \jn$ denote the first \Time tha walk reaches $r$. By reflection principle (\ref{thm-reflection_principle}), we can reflect the segment from $\left(k,r\right)$ to $ \left( n,b \right) $ in the axis:$y=r$.
 Therefore we now have path from $ \left( 0,0 \right) $ to $ \left( n,2r-b \right) $
 and we get that
 \[
 \begin{split}
  N_n^r \left( 0,b \right) =N_n \left( 0,2r-b \right) \text{ hence } \pr \left( S_n=b, M_n^+\geq r \right)
 =N_n^r \left( 0,b \right) p^{\frac{n+b}{2}}q^{\frac{n-b}{2}}=\\
 N_n \left( 0,2r-b \right) p^{\frac{n+ \left( 2r-b \right) }{2}}q^{\frac{n- \left( 2r-b \right) }{2}}p^{b-r}q^{r-b}= \left( \frac{q}{p} \right) ^{r-b}\pr \left( S_n=2r-b \right).
\end{split}
 \]
\end{proof}

\begin{defn}[Walk reaching new maximum at particular \Time]\label{defn-new_maximum}
 \Lrw\ $n,b\in \N$. We say that \emph{the walk reached new maximum $b$ \intime $n$} if $M_{n-1}^+=S_{n-1}=b-1, S_n=b$. We denote such probability by $f_b \left( n \right).$
\end{defn}
\begin{thm}[Probability of reaching new maximum $b$ \intime $n$]\label{thm-probability_new_maximum}
 \Lrw\ $n,b \in \N$ then
 \[
  f_b \left( n \right) =\frac{b}{n}\pr \left( S_n=b \right).
 \]
\end{thm}
\begin{proof}
  \[
  \begin{split}
    f_b & = \pr \left( M_{n-1}=S_{n-1}=b-1, S_n=b \right)
    =\pr \left(M_{n-1}=S_{n-1}=b-1, X_n=+1\right)\\
    & =p\pr \left( M_{n-1}=S_{n-1}=b-1 \right)\\
    & \overset{*}{=}p \left( \pr \left( M_{n-1}\geq b-1, S_{n-1}=b-1 \right) -\pr \left( M_{n-1}\geq b, S_{n-1}=b-1 \right) \right) \\
    & \overset{\text{T}\ref{thm-probability_maximum_upto_time}}{=}p \left( \pr \left( S_{n-1}=b-1 \right) -\frac{q}{p}\pr \left( S_{n-1}=b+1 \right) \right) \\
    & =p\pr \left( S_{n-1}=b-1 \right) -q \pr \left( S_{n-1}=b+1 \right) \\
    & =\binom{n-1}{\frac{n}{2}+\frac{b}{2}-1}p^{\frac{n}{2}+\frac{b}{2}}q^{\frac{n}{2}-\frac{b}{2}}-\binom{n-1}{\frac{n}{2}+\frac{b}{2}}
    p^{\frac{n}{2}+\frac{b}{2}}q^{\frac{n}{2}-\frac{b}{2}}\\
    & =p^{\frac{n}{2}+\frac{b}{2}}q^{\frac{n}{2}-\frac{b}{2}} \left( \frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2}-1 \right) ! \left( \frac{n}{2}-\frac{b}{2} \right) !}-\frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2} \right) ! \left( \frac{n}{2}-\frac{b}{2}-1 \right) !} \right)\\
    & =p^{\frac{n}{2}+\frac{b}{2}}q^{\frac{n}{2}-\frac{b}{2}} \left( \frac{ \left( n-1 \right) !}{ \left( \frac{n}{2}+\frac{b}{2}-1 \right) ! \left( \frac{n}{2}-\frac{b}{2}-1 \right) !} \right) \left( \frac{1}{\frac{n}{2}-\frac{b}{2}}-\frac{1}{\frac{n}{2}+\frac{b}{2}} \right) \\
    & =p^{\frac{n}{2}+\frac{b}{2}}q^{\frac{n}{2}-\frac{b}{2}}\frac{b}{n} \left( \frac{n!}{ \left( \frac{n}{2}+\frac{b}{2} \right) ! \left( \frac{n}{2}-\frac{b}{2} \right) !} \right)
    =\frac{b}{n}p^{\frac{n}{2}+\frac{b}{2}}q^{\frac{n}{2}-\frac{b}{2}}\binom{n}{\frac{n}{2}+\frac{b}{2}}
    =\frac{b}{n}\pr \left( S_n=b \right).
     \end{split}
  \]
 Where $*$ comes from the fact that the event $[M_{n-1}\geq b-1]$ can be split into two disjoint events:
 $[M_{n-1}\geq b-1]=[M_{n-1}\geq b]\cup [M_{n-1}=b-1].$

 Hence: $\pr\left(M_{n-1}=b-1\right)=\pr\left(M_{n-1}\geq b-1\right)-\pr\left(M_{n-1}\geq b\right).$ The same applies for the probability $\pr\left(M_{n-1}=b-1, S_{n-1}=b-1\right)
 $
 %druhÃ¡ rovnost $\pr \left( X_n=1 \right) =p$
\end{proof}
\begin{comment}
\begin{thm}[XXXMean number of visits to $b$ before returning to origin in symmetric random walk]\label{thm-mean_number_visits}
 \Lrws. Mean number $\mu_b$ of visits of the walk to point $b$ before returning to origin is equal to 1.
\end{thm}
\begin{proof}
 aa
\end{proof}
\end{comment}
